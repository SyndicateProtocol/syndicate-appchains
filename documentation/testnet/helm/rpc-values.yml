ingress:
  hosts:
    - host: {{ HOST }}
      paths:
        - path: /
          pathType: Prefix
          service:
            name: {{ SERVICE_NAME }}
            port: 8449
mchain:
  image:
    pullPolicy: IfNotPresent
    tag: "{{ IMAGE_TAG }}"
  env:
  - name: RUST_LOG
    value: "warn"
  - name: APPCHAIN_CHAIN_ID
    value: "{{ CHAIN_ID }}"
  - name: DATADIR
    value: "/datadir"
translator:
  image:
    pullPolicy: IfNotPresent
    tag: "{{ IMAGE_TAG }}"
  env:
  - name: RUST_LOG
    value: "warn"
  - name: APPCHAIN_CHAIN_ID
    value: "{{ CHAIN_ID }}"
  - name: SEQUENCING_WS_URL
    value: "{{ SEQUENCING_WS_URL }}"
  - name: SETTLEMENT_WS_URL
    value: "{{ SETTLEMENT_WS_URL }}"
  - name: SEQUENCING_START_BLOCK
    value: "{{ SEQUENCING_START_BLOCK_DEFAULTS_TO_ZERO }}"
  - name: SETTLEMENT_START_BLOCK
    value: "{{ SETTLEMENT_START_BLOCK_DEFAULTS_TO_ZERO }}"
  - name: SEQUENCING_CONTRACT_ADDRESS
    value: "{{ SEQUENCING_CONTRACT_ADDRESS }}"
  - name: ARBITRUM_BRIDGE_ADDRESS
    value: "{{ ARBITRUM_BRIDGE_ADDRESS }}"
  - name: ARBITRUM_INBOX_ADDRESS
    value: "{{ ARBITRUM_INBOX_ADDRESS }}"
  - name: MCHAIN_WS_URL
    value: "{{ LOCAL_MCHAIN_WS_RPC_URL }}"
  - name: SETTLEMENT_DELAY
    value: "60"
nitro:
  configmap:
    data:
      parent-chain:
        id: 511000
        connection:
          url: {{ LOCAL_MCHAIN_WS_RPC_URL }}
      chain:
        id: {{ CHAIN_ID }}
        name: {{ CHAIN_NAME }}
        info-json: |-
          {{ CHAIN_INFO_JSON }}
  # Here is an example init container that works well for us - it waits for the mchain websocket rpc to be available
  # initContainers:
  # - name: init-nitro
  #   image: solsson/websocat
  #   command: 
  #   - /bin/sh
  #   - -c
  #   - |
  #     for i in $(seq 1 300); do
  #       if echo '{"jsonrpc":"2.0","id":1,"method":"eth_getBlockByNumber","params":["latest",false]}' | websocat -1 {{ LOCAL_MCHAIN_WS_RPC_URL }} | grep -q "result"; then
  #         sleep 5 && exit 0
  #       fi
  #       echo "Waiting for mchain WebSocket RPC to be available... (attempt $i/300)"
  #       sleep 2
  #     done
  #     echo "Timeout waiting for mchain WebSocket RPC"
  #     exit 1
  #   resources:
  #     requests:
  #       cpu: 100m
  #       memory: 64Mi
  #     limits:
  #       cpu: 200m
  #       memory: 128Mi